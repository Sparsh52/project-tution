{% extends "base5.html" %}
{% block content %}
    <h2 class="mb-4">Session Requests</h2>
    {% if messages %}
    {% for message in messages %}
        <div class="alert alert-danger message" role="alert"> {{ message }}
        </div>
    {% endfor %}
    {% endif %}
    {% if session_requests %}
        <div class="card-deck">
            {% for request in session_requests %}
                {% if not request.is_approved %}
                    <div class="card mb-4">
                        <div class="card-body d-flex align-items-center">
                            <div class="col-md-2">
                                <img class="img-fluid rounded-circle" src="{{ request.student.student_image_url }}" alt="Student Image" style="width: 60px; height: 60px;">
                            </div>
                            <div class="ml-3">
                                <h5 class="card-title">{{ request.student.user.name }} requested a session</h5>
                                <p class="card-text">Date and Time: {{ request.start_time }} to {{ request.end_time }}</p>
                                <p class="card-text">{{ request.title }}</p>
                                <p class="card-text">{{ request.message }}</p>
                                <p class="card-text"> &#8377;{{ request.requested_cost }}</p>
                                <a href="{% url 'approve_session_requests' session_id=request.id %}" class="btn btn-warning">Approve</a>
                                <button class="btn btn-danger reject-btn" data-request-id="{{ request.id }}">Reject</button>
                            </div>
                        </div>
                    </div>
                {% endif %}
            {% endfor %}
        </div>
    {% else %}
            <div class="alert alert-info" role="alert">
                No Session Requests.
        </div>
    {% endif %}

    <script>
        // Add event listener to all reject buttons
        document.querySelectorAll('.reject-btn').forEach(function(btn) {
            btn.addEventListener('click', function() {
                // Show a confirmation dialog
                var confirmReject = confirm('Are you sure you want to reject this session request?');

                // If the user confirms, proceed with the rejection
                if (confirmReject) {
                    var requestId = btn.getAttribute('data-request-id');
                    window.location.href = '/delete-request/' + requestId;
                }
            });
        });
    </script>
    <script src="https://code.jquery.com/jquery-3.6.4.min.js"></script>
    <script>
      $(document).ready(function() {
          // Timeout for message disappearance
          setTimeout(function() {
              $('.alert-danger').fadeOut('slow');
          }, 2000); // Adjust the time in milliseconds as needed
  
          // Delete message on click (optional)
          $('.del-msg').on('click', function() {
              $(this).parent().hide();
          });
      });
    </script>
{% endblock %}
